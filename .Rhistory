}
if(layer == "layer_4_CAF"){
if(levels(as.factor(is.na(layer_predictions) %in% TRUE))){
predicted_class <- "Cell low quality"
}
else{
predicted_class <- names(sort(unlist(as.vector(layer_predictions[,colnames(layer_predictions)[which(lapply(layer_predictions, class) == "numeric")]])), decreasing = T)[1])
}
}
if(layer == "layer_5_cDC"){
if(levels(as.factor(is.na(layer_predictions) %in% TRUE))){
predicted_class <- "Cell low quality"
}
else{
predicted_class <- names(sort(unlist(as.vector(layer_predictions[,colnames(layer_predictions)[which(lapply(layer_predictions, class) == "numeric")]])), decreasing = T)[1])
}
}
if(layer == "layer_5_macrophage"){
if(levels(as.factor(is.na(layer_predictions) %in% TRUE))){
predicted_class <- "Cell low quality"
}
else{
predicted_class <- names(sort(unlist(as.vector(layer_predictions[,colnames(layer_predictions)[which(lapply(layer_predictions, class) == "numeric")]])), decreasing = T)[1])
}
}
if(layer == "layer_5_monocyte"){
if(levels(as.factor(is.na(layer_predictions) %in% TRUE))){
predicted_class <- "Cell low quality"
}
else{
predicted_class <- names(sort(unlist(as.vector(layer_predictions[,colnames(layer_predictions)[which(lapply(layer_predictions, class) == "numeric")]])), decreasing = T)[1])
}
}
return(predicted_class)
}
predicted_class <- unlist(parallel::mclapply(row.names(layer_predictions),
score_class_test, predictions = layer_predictions,
layer = layer, mc.cores = mc.cores), use.names = F)
#' Score Class
#'
#' @param cell_name the name of the cell to score
#' @param predictions path to the matrix generated from classify cells
#' @param layer layer of the model can be layer_1, layer_2_blood, layer_2_cancer, layer_3_TNK, layer_3_MDC, layer_3_BCell, layer_4_CD4_CD8, layer_4_CD8_NK, layer_3_ov_endo, layer_3_breast_lung, layer_3_brain_lung_nbm_skin, layer_4_brain_nbm_skin, layer_5_brain_nbm
#'
#' @return A vector of the predicted class based on scores
#' @export
score_class_test <- function(cell_name, predictions, layer){
if(.Platform$OS.type == "windows"){
mc.cores = 1
}
layer_predictions <- predictions[cell_name,]
if(layer == "layer_1"){
if(levels(as.factor(is.na(layer_predictions) %in% TRUE))){
predicted_class <- "Cell low quality"
}
else if(names(sort(unlist(as.vector(layer_predictions[,c("cancer_normal_stromal_score","blood_score")])),decreasing = T)[1])
== "cancer_normal_stromal_score"){
predicted_class <- "Tissue_Cell_Normal_or_Cancer"
}
else if(names(sort(unlist(as.vector(layer_predictions[,c("cancer_normal_stromal_score","blood_score")])),decreasing = T)[1])
== "blood_score"){
predicted_class <- "Blood_Cell"
} else{
predicted_class <- names(sort(unlist(as.vector(layer_predictions[,colnames(layer_predictions)[which(lapply(layer_predictions, class) == "numeric")]])), decreasing = T)[1])
}
}
if(layer == "layer_2_blood"){
if(levels(as.factor(is.na(layer_predictions) %in% TRUE))){
predicted_class <- "Cell low quality"
}
else if(names(sort(unlist(as.vector(layer_predictions[,c("B_cell_score","non_B_lymphocyte_score", "macrophage_DC_score", "HSPC_score","mast_score")])),decreasing = T)[1])
== "B_cell_score"){
predicted_class <- "B cell or Plasmablast"
}
else if(names(sort(unlist(as.vector(layer_predictions[,c("B_cell_score","non_B_lymphocyte_score", "macrophage_DC_score", "HSPC_score","mast_score")])),decreasing = T)[1])
== "non_B_lymphocyte_score"){
predicted_class <- "T_or_NK_lymphocyte"
}
else if(names(sort(unlist(as.vector(layer_predictions[,c("B_cell_score","non_B_lymphocyte_score", "macrophage_DC_score", "HSPC_score","mast_score")])),decreasing = T)[1])
== "macrophage_DC_score"){
predicted_class <- "macrophage_or_dendritic_cell"
}
else if(names(sort(unlist(as.vector(layer_predictions[,c("B_cell_score","non_B_lymphocyte_score", "macrophage_DC_score", "HSPC_score","mast_score")])),decreasing = T)[1])
== "mast_score"){
predicted_class <- "Mast cell"
}
else{
predicted_class <- names(sort(unlist(as.vector(layer_predictions[,colnames(layer_predictions)[which(lapply(layer_predictions, class) == "numeric")]])), decreasing = T)[1])
}
}
if(layer == "layer_3_TNK"){
if(levels(as.factor(is.na(layer_predictions) %in% TRUE))){
predicted_class <- "Cell low quality"
}
else if(names(sort(unlist(as.vector(layer_predictions[,c("CD4_CD8_score", "NK_CD8_score")])),decreasing = T)[1])
== "CD4_CD8_score"){
predicted_class <- "CD4 or CD8 T cell"
}
else if(names(sort(unlist(as.vector(layer_predictions[,c("CD4_CD8_score", "NK_CD8_score")])),decreasing = T)[1])
== "NK_CD8_score"){
predicted_class <- "NK or CD8 T cell"
} else{
predicted_class <- names(sort(unlist(as.vector(layer_predictions[,colnames(layer_predictions)[which(lapply(layer_predictions, class) == "numeric")]])), decreasing = T)[1])
}
}
if(layer == "layer_3_MDC"){
if(levels(as.factor(is.na(layer_predictions) %in% TRUE))){
predicted_class <- "Cell low quality"
}
else if(names(sort(unlist(as.vector(layer_predictions[,c("macrophage_score", "DC_score")])),decreasing = T)[1])
== "macrophage_score"){
predicted_class <- "Macrophage or Monocyte"
}
else if(names(sort(unlist(as.vector(layer_predictions[,c("macrophage_score", "DC_score")])),decreasing = T)[1])
== "DC_score"){
predicted_class <- "Dendritic Cell"
} else{
predicted_class <- names(sort(unlist(as.vector(layer_predictions[,colnames(layer_predictions)[which(lapply(layer_predictions, class) == "numeric")]])), decreasing = T)[1])
}
}
if(layer == "layer_3_BCell"){
if(levels(as.factor(is.na(layer_predictions) %in% TRUE))){
predicted_class <- "Cell low quality"
}
else if(names(sort(unlist(as.vector(layer_predictions[,c("B_cell_score", "plasmablast_score")])),decreasing = T)[1])
== "B_cell_score"){
predicted_class <- "B Cell"
}
else if(names(sort(unlist(as.vector(layer_predictions[,c("B_cell_score", "plasmablast_score")])),decreasing = T)[1])
== "plasmablast_score"){
predicted_class <- "Plasmablast"
} else{
predicted_class <- names(sort(unlist(as.vector(layer_predictions[,colnames(layer_predictions)[which(lapply(layer_predictions, class) == "numeric")]])), decreasing = T)[1])
}
}
if(layer == "layer_4_CD4_CD8"){
if(levels(as.factor(is.na(layer_predictions) %in% TRUE))){
predicted_class <- "Cell low quality"
}
else if(names(sort(unlist(as.vector(layer_predictions[,colnames(layer_predictions)[which(lapply(layer_predictions, class) == "numeric")]])), decreasing = T)[1])
== "CD4+ T cell"){
predicted_class <- "CD4+ T cell"
}
else if(names(sort(unlist(as.vector(layer_predictions[,colnames(layer_predictions)[which(lapply(layer_predictions, class) == "numeric")]])), decreasing = T)[1])
== "CD8+ T cell"){
predicted_class <- "CD8+ T cell"
} else{
predicted_class <- names(sort(unlist(as.vector(layer_predictions[,colnames(layer_predictions)[which(lapply(layer_predictions, class) == "numeric")]])), decreasing = T)[1])
}
}
if(layer == "layer_5_CD4"){
if(levels(as.factor(is.na(layer_predictions) %in% TRUE))){
predicted_class <- "Cell low quality"
}
else if(names(sort(unlist(as.vector(layer_predictions[,colnames(layer_predictions)[which(lapply(layer_predictions, class) == "numeric")]])), decreasing = T)[1])
== "Naive CD4 T cells"){
predicted_class <- "Naive CD4+ T cells"
}
else if(names(sort(unlist(as.vector(layer_predictions[,colnames(layer_predictions)[which(lapply(layer_predictions, class) == "numeric")]])), decreasing = T)[1])
== "Temra CD4 T cells"){
predicted_class <- "Terminally differentiated effector CD4+ T cells"
}
else if(names(sort(unlist(as.vector(layer_predictions[,colnames(layer_predictions)[which(lapply(layer_predictions, class) == "numeric")]])), decreasing = T)[1])
== "Tfh/Th1 CD4 T cells"){
predicted_class <- "Tfh/Th1 helper CD4+ T cells"
}
else if(names(sort(unlist(as.vector(layer_predictions[,colnames(layer_predictions)[which(lapply(layer_predictions, class) == "numeric")]])), decreasing = T)[1])
== "Treg"){
predicted_class <- "T regulatory cells"
} else{
predicted_class <- names(sort(unlist(as.vector(layer_predictions[,colnames(layer_predictions)[which(lapply(layer_predictions, class) == "numeric")]])), decreasing = T)[1])
}
}
if(layer == "layer_4_CD8_NK"){
if(levels(as.factor(is.na(layer_predictions) %in% TRUE))){
predicted_class <- "Cell low quality"
}
else if(names(sort(unlist(as.vector(layer_predictions[,colnames(layer_predictions)[which(lapply(layer_predictions, class) == "numeric")]])), decreasing = T)[1])
== "CD8+ T cell"){
predicted_class <- "CD8+ T cell"
}
else if(names(sort(unlist(as.vector(layer_predictions[,colnames(layer_predictions)[which(lapply(layer_predictions, class) == "numeric")]])), decreasing = T)[1])
== "Natural killer cell"){
predicted_class <- "Natural killer cell"
} else{
predicted_class <- names(sort(unlist(as.vector(layer_predictions[,colnames(layer_predictions)[which(lapply(layer_predictions, class) == "numeric")]])), decreasing = T)[1])
}
}
if(layer == "layer_5_CD8"){
if(levels(as.factor(is.na(layer_predictions) %in% TRUE))){
predicted_class <- "Cell low quality"
}
else if(names(sort(unlist(as.vector(layer_predictions[,colnames(layer_predictions)[which(lapply(layer_predictions, class) == "numeric")]])), decreasing = T)[1])
== "Naive CD8 T cells"){
predicted_class <- "Naive CD8+ T cells"
}
else if(names(sort(unlist(as.vector(layer_predictions[,colnames(layer_predictions)[which(lapply(layer_predictions, class) == "numeric")]])), decreasing = T)[1])
== "MAIT"){
predicted_class <- "MAIT cells"
}
else if(names(sort(unlist(as.vector(layer_predictions[,colnames(layer_predictions)[which(lapply(layer_predictions, class) == "numeric")]])), decreasing = T)[1])
== "Exausted CD8 T cells"){
predicted_class <- "Exhausted CD8+ T cells"
}
else{
predicted_class <- names(sort(unlist(as.vector(layer_predictions[,colnames(layer_predictions)[which(lapply(layer_predictions, class) == "numeric")]])), decreasing = T)[1])
}
}
if(layer == "layer_2_non_blood"){
if(levels(as.factor(is.na(layer_predictions) %in% TRUE))){
predicted_class <- "Cell low quality"
}else if(names(sort(unlist(as.vector(layer_predictions[,c("stromal_score","non_stromal_score","Oligodendrocytes", "Glial Cells" )])),decreasing = T)[1])
== "stromal_score"){
predicted_class <- "Stromal Cell"
}
else if(names(sort(unlist(as.vector(layer_predictions[,c("stromal_score","non_stromal_score","Oligodendrocytes", "Glial Cells" )])),decreasing = T)[1])
== "non_stromal_score"){
predicted_class <- "Non Stromal Cell"
}
else{
predicted_class <- names(sort(unlist(as.vector(layer_predictions[,colnames(layer_predictions)[which(lapply(layer_predictions, class) == "numeric")]])), decreasing = T)[1])
}
}
if(layer == "layer_3_non_stromal"){
if(levels(as.factor(is.na(layer_predictions) %in% TRUE))){
predicted_class <- "Cell low quality"
}else if(names(sort(unlist(as.vector(layer_predictions[,colnames(layer_predictions)[which(lapply(layer_predictions, class) == "numeric")]])), decreasing = T)[1])
== "soft_tissue_neuro_score"){
predicted_class <- "Soft Tissue or Neuro Cancer Cell"
}
else if(names(sort(unlist(as.vector(layer_predictions[,colnames(layer_predictions)[which(lapply(layer_predictions, class) == "numeric")]])), decreasing = T)[1])
== "non_GI_score"){
predicted_class <- "Non GI Epithelial Cell"
}
else if(names(sort(unlist(as.vector(layer_predictions[,colnames(layer_predictions)[which(lapply(layer_predictions, class) == "numeric")]])), decreasing = T)[1])
== "GI_score"){
predicted_class <- "GI Epithelial Cell"
}
else{
predicted_class <- names(sort(unlist(as.vector(layer_predictions[,colnames(layer_predictions)[which(lapply(layer_predictions, class) == "numeric")]])), decreasing = T)[1])
}
}
if(layer == "layer_4_non_GI"){
if(levels(as.factor(is.na(layer_predictions) %in% TRUE))){
predicted_class <- "Cell low quality"
}
else if(names(sort(unlist(as.vector(layer_predictions[,colnames(layer_predictions)[which(lapply(layer_predictions, class) == "numeric")]])), decreasing = T)[1])
== "ov_endo_kid_score"){
predicted_class <- "Ovarian/Endometrial/Kidney Cell"
}
else if(names(sort(unlist(as.vector(layer_predictions[,colnames(layer_predictions)[which(lapply(layer_predictions, class) == "numeric")]])), decreasing = T)[1])
== "breast_lung_prostate_score"){
predicted_class <- "Breast/Lung/Prostate Cell"
}
else{
predicted_class <- names(sort(unlist(as.vector(layer_predictions[,colnames(layer_predictions)[which(lapply(layer_predictions, class) == "numeric")]])), decreasing = T)[1])
}
}
if(layer == "layer_4_GI"){
if(levels(as.factor(is.na(layer_predictions) %in% TRUE))){
predicted_class <- "Cell low quality"
}
else if(names(sort(unlist(as.vector(layer_predictions[,colnames(layer_predictions)[which(lapply(layer_predictions, class) == "numeric")]])), decreasing = T)[1])
== "billiary_score"){
predicted_class <- "Billiary Cell"
}
else if(names(sort(unlist(as.vector(layer_predictions[,colnames(layer_predictions)[which(lapply(layer_predictions, class) == "numeric")]])), decreasing = T)[1])
== "digestive_score"){
predicted_class <- "Colorectal/Esophageal/Gastric Cell"
}
else{
predicted_class <- names(sort(unlist(as.vector(layer_predictions[,colnames(layer_predictions)[which(lapply(layer_predictions, class) == "numeric")]])), decreasing = T)[1])
}
}
if(layer == "layer_5_ov_endo_kid"){
if(levels(as.factor(is.na(layer_predictions) %in% TRUE))){
predicted_class <- "Cell low quality"
}
else if(names(sort(unlist(as.vector(layer_predictions[,colnames(layer_predictions)[which(lapply(layer_predictions, class) == "numeric")]])), decreasing = T)[1])
== "Ovarian Cancer"){
predicted_class <- "Ovarian Cancer Cell"
}
else if(names(sort(unlist(as.vector(layer_predictions[,colnames(layer_predictions)[which(lapply(layer_predictions, class) == "numeric")]])), decreasing = T)[1])
== "Endometrial/Uterine Cancer"){
predicted_class <- "Endometrial Cancer Cell"
}else if(names(sort(unlist(as.vector(layer_predictions[,colnames(layer_predictions)[which(lapply(layer_predictions, class) == "numeric")]])), decreasing = T)[1])
== "Kidney Cancer"){
predicted_class <- "Kidney Cancer Cell"
} else{
predicted_class <- names(sort(unlist(as.vector(layer_predictions[,colnames(layer_predictions)[which(lapply(layer_predictions, class) == "numeric")]])), decreasing = T)[1])
}
}
if(layer == "layer_5_breast_lung_prostate"){
if(levels(as.factor(is.na(layer_predictions) %in% TRUE))){
predicted_class <- "Cell low quality"
}
else if(names(sort(unlist(as.vector(layer_predictions[,colnames(layer_predictions)[which(lapply(layer_predictions, class) == "numeric")]])), decreasing = T)[1])
== "Breast Cancer"){
predicted_class <- "Breast Cancer Cell"
}
else if(names(sort(unlist(as.vector(layer_predictions[,colnames(layer_predictions)[which(lapply(layer_predictions, class) == "numeric")]])), decreasing = T)[1])
== "Lung Cancer"){
predicted_class <- "Lung Cancer Cell"
}else if(names(sort(unlist(as.vector(layer_predictions[,colnames(layer_predictions)[which(lapply(layer_predictions, class) == "numeric")]])), decreasing = T)[1])
== "Prostate Cancer"){
predicted_class <- "Prostate Cancer Cell"
} else{
predicted_class <- names(sort(unlist(as.vector(layer_predictions[,colnames(layer_predictions)[which(lapply(layer_predictions, class) == "numeric")]])), decreasing = T)[1])
}
}
if(layer == "layer_6_breast"){
if(levels(as.factor(is.na(layer_predictions) %in% TRUE))){
predicted_class <- "Cell low quality"
}
else if(names(sort(unlist(as.vector(layer_predictions[,colnames(layer_predictions)[which(lapply(layer_predictions, class) == "numeric")]])), decreasing = T)[1])
== "TNBC"){
predicted_class <- "TNBC Breast Cancer Cell"
}
else if(names(sort(unlist(as.vector(layer_predictions[,colnames(layer_predictions)[which(lapply(layer_predictions, class) == "numeric")]])), decreasing = T)[1])
== "HER2+"){
predicted_class <- "Her2+ Breast Cancer Cell"
}else if(names(sort(unlist(as.vector(layer_predictions[,colnames(layer_predictions)[which(lapply(layer_predictions, class) == "numeric")]])), decreasing = T)[1])
== "ER+"){
predicted_class <- "ER+ Breast Cancer Cell"
} else{
predicted_class <- names(sort(unlist(as.vector(layer_predictions[,colnames(layer_predictions)[which(lapply(layer_predictions, class) == "numeric")]])), decreasing = T)[1])
}
}
if(layer == "layer_5_biliary"){
if(levels(as.factor(is.na(layer_predictions) %in% TRUE))){
predicted_class <- "Cell low quality"
} else{
predicted_class <- names(sort(unlist(as.vector(layer_predictions[,colnames(layer_predictions)[which(lapply(layer_predictions, class) == "numeric")]])), decreasing = T)[1])
}
}
if(layer == "layer_3_stromal"){
if(levels(as.factor(is.na(layer_predictions) %in% TRUE))){
predicted_class <- "Cell low quality"
} else if(names(sort(unlist(as.vector(layer_predictions[,colnames(layer_predictions)[which(lapply(layer_predictions, class) == "numeric")]])), decreasing = T)[1])
== "fibroblasts_score"){
predicted_class <- "Fibroblasts"
}else if(names(sort(unlist(as.vector(layer_predictions[,colnames(layer_predictions)[which(lapply(layer_predictions, class) == "numeric")]])), decreasing = T)[1])
== "cancer_associated_fibroblast_score"){
predicted_class <- "Cancer Associated Fibroblasts"
}else{
predicted_class <- names(sort(unlist(as.vector(layer_predictions[,colnames(layer_predictions)[which(lapply(layer_predictions, class) == "numeric")]])), decreasing = T)[1])
}
}
if(layer == "layer_4_soft_tissue_neuro"){
if(levels(as.factor(is.na(layer_predictions) %in% TRUE))){
predicted_class <- "Cell low quality"
}
else if(names(sort(unlist(as.vector(layer_predictions[,colnames(layer_predictions)[which(lapply(layer_predictions, class) == "numeric")]])), decreasing = T)[1])
== "soft_tissue_neuro_score"){
predicted_class <- "Soft Tissue or Neuro Cancer Cell"
} else{
predicted_class <- names(sort(unlist(as.vector(layer_predictions[,colnames(layer_predictions)[which(lapply(layer_predictions, class) == "numeric")]])), decreasing = T)[1])
}
}
if(layer == "layer_5_soft_tissue_neuro"){
if(levels(as.factor(is.na(layer_predictions) %in% TRUE))){
predicted_class <- "Cell low quality"
}
else if(names(sort(unlist(as.vector(layer_predictions[,colnames(layer_predictions)[which(lapply(layer_predictions, class) == "numeric")]])), decreasing = T)[1])
== "brain_nbm_score"){
predicted_class <- "Brain/Neuroblastoma Cancer Cell"
} else if(names(sort(unlist(as.vector(layer_predictions[,colnames(layer_predictions)[which(lapply(layer_predictions, class) == "numeric")]])), decreasing = T)[1])
== "soft_tissue_score"){
predicted_class <- "Soft Tissue Cancer Cell"
} else{
predicted_class <- names(sort(unlist(as.vector(layer_predictions[,colnames(layer_predictions)[which(lapply(layer_predictions, class) == "numeric")]])), decreasing = T)[1])
}
}
if(layer == "layer_5_digestive"){
if(levels(as.factor(is.na(layer_predictions) %in% TRUE))){
predicted_class <- "Cell low quality"
}
else{
predicted_class <- names(sort(unlist(as.vector(layer_predictions[,colnames(layer_predictions)[which(lapply(layer_predictions, class) == "numeric")]])), decreasing = T)[1])
}
}
if(layer == "layer_6_brain_nbm"){
if(levels(as.factor(is.na(layer_predictions) %in% TRUE))){
predicted_class <- "Cell low quality"
}
else{
predicted_class <- names(sort(unlist(as.vector(layer_predictions[,colnames(layer_predictions)[which(lapply(layer_predictions, class) == "numeric")]])), decreasing = T)[1])
}
}
if(layer == "layer_6_soft_tissue"){
if(levels(as.factor(is.na(layer_predictions) %in% TRUE))){
predicted_class <- "Cell low quality"
}
else{
predicted_class <- names(sort(unlist(as.vector(layer_predictions[,colnames(layer_predictions)[which(lapply(layer_predictions, class) == "numeric")]])), decreasing = T)[1])
}
}
if(layer == "layer_4_dendritic"){
if(levels(as.factor(is.na(layer_predictions) %in% TRUE))){
predicted_class <- "Cell low quality"
}
else{
predicted_class <- names(sort(unlist(as.vector(layer_predictions[,colnames(layer_predictions)[which(lapply(layer_predictions, class) == "numeric")]])), decreasing = T)[1])
}
}
if(layer == "layer_4_macrophage"){
if(levels(as.factor(is.na(layer_predictions) %in% TRUE))){
predicted_class <- "Cell low quality"
}
else{
predicted_class <- names(sort(unlist(as.vector(layer_predictions[,colnames(layer_predictions)[which(lapply(layer_predictions, class) == "numeric")]])), decreasing = T)[1])
}
}
if(layer == "layer_4_CAF"){
if(levels(as.factor(is.na(layer_predictions) %in% TRUE))){
predicted_class <- "Cell low quality"
}
else{
predicted_class <- names(sort(unlist(as.vector(layer_predictions[,colnames(layer_predictions)[which(lapply(layer_predictions, class) == "numeric")]])), decreasing = T)[1])
}
}
if(layer == "layer_5_cDC"){
if(levels(as.factor(is.na(layer_predictions) %in% TRUE))){
predicted_class <- "Cell low quality"
}
else{
predicted_class <- names(sort(unlist(as.vector(layer_predictions[,colnames(layer_predictions)[which(lapply(layer_predictions, class) == "numeric")]])), decreasing = T)[1])
}
}
if(layer == "layer_5_macrophage"){
if(levels(as.factor(is.na(layer_predictions) %in% TRUE))){
predicted_class <- "Cell low quality"
}
else{
predicted_class <- names(sort(unlist(as.vector(layer_predictions[,colnames(layer_predictions)[which(lapply(layer_predictions, class) == "numeric")]])), decreasing = T)[1])
}
}
if(layer == "layer_5_monocyte"){
if(levels(as.factor(is.na(layer_predictions) %in% TRUE))){
predicted_class <- "Cell low quality"
}
else{
predicted_class <- names(sort(unlist(as.vector(layer_predictions[,colnames(layer_predictions)[which(lapply(layer_predictions, class) == "numeric")]])), decreasing = T)[1])
}
}
return(predicted_class)
}
layer_predictions <- classify_cells_RNA_no_scale(rna_counts = rna_counts, imputation = imputation,
genes_in_model = genes_in_model,
model = model, cells_to_use = cells_to_use,
ref_based = ref_based, normalized_counts=normalized_counts, mc.cores = mc.cores)
layer_predictions <- add_class_per_layer(layer_predictions = layer_predictions,
layer = layer)
predicted_class <- unlist(parallel::mclapply(row.names(layer_predictions),
score_class_test, predictions = layer_predictions,
layer = layer, mc.cores = mc.cores), use.names = F)
layer_predictions <- cbind(layer_predictions, predicted_class)
layer_predictions$predicted_class <- as.character(predicted_class)
threshold_per_class <- get_auto_threshold(layer_predictions, mc.cores=mc.cores)
predicted_tissue_with_cutoff <- unlist(parallel::mclapply(row.names(layer_predictions),
add_unclassified_automatic_threshold, predictions = layer_predictions,
layer = layer, threshold_use = threshold_per_class,
mc.cores = mc.cores), use.names = F)
layer_predictions <- cbind(layer_predictions, predicted_tissue_with_cutoff)
View(layer_predictions)
devtools::document()
devtools::install()
usethis::use_version()
devtools::document()
usethis::use_version()
usethis::use_version()
?CNA.MCMC
library(copykat)
?CNA.MCMC
CNA.MCMC
library(scATOMIC)
library(plyr)
library(dplyr)
library(data.table)
library(randomForest)
library(caret)
library(parallel)
library(reticulate)
library(Rmagic)
library(Matrix)
library(Seurat)
library(agrmt)
library(cutoff.scATOMIC)
library(copykat)
library(ggplot2)
allres = readRDS("~/Downloads/allmat.rds")
dim(allres)
head(allres)
View(as.data.frame(row.names(allres)))
cell_predictions <- run_scATOMIC(allres)
dim(allmat)
allmat = readRDS("~/Downloads/allmat.rds")
dim(allmat)
pct_mt <- colSums(allmat[grep("^MT-", row.names(allmat)),])/colSums(allmat) * 100
nFeatureRNA <- colSums(allmat > 0)
allmat <- allmat[, names(which(pct_mt < 25))]
allmat <- allmat[, intersect(names(which(nFeatureRNA > 500)), colnames(allmat))]
dim(allmat)
nCell <- rowSums(allmat > 0)
summary(nCell)
nCell
#only keep genes with > than 10 cells
allmat <- allmat[names(which(nCell > 10)), ]
dim(allmat)
dim(unique(allmat))
dim(unique(as.matrix(allmat)))
View(as.data.frame(row.names(allres)))
